<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="UTF-8">
	
	<link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" href="bootstrap/dist/css/bootstrap.css"/>
  <script src="bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="jquery/dist/jquery.min.js"></script>
	<title>Unit 1</title>
</head>
<body>
	<h2 id="username">Welcome, <span id="user">[USER]</span></h2>
	<nav class="navbar justify-content-between" id="navbar">
			<ul class="form-inline" id="fieldUnits">
				<li><a class="active" href="#">Tilapia1</a></li>
				<li><a href="#">Placeholder1</a></li>
				<li><a href="#">Placeholder2</a></li>
				<li><a href="#">Placeholder3</a></li>
			</ul>
			<ul class="form-inline">
				<li><a href='/addFieldUnit'>Add Field Unit</a></li>
				<li><a href='#' onClick='$(this).logout()'>Logout</a></li>
			</ul>
		</nav>
	<div class="contentBox container">
		<h2>Add Field Unit</h2>
		<hr>
		<div id="mainContainer">

		</div>
		<div class="row" id="statsContent">
			<div class="col-8" id="unitDetails">
				<table>
					<tr>
						<th>Field Unit Label</th>
						<td><input id="fieldLabel" type="text" placeholder="Field Unit Label"/></td>
					</tr>
					<tr>
						<th>Field Unit Phone Number</th>
						<td><input id="fieldNumber" type="text" placeholder="Phone Number of Field Unit" value="+639"/></td>
					</tr>
					<tr>
						<th>Species</th>
						<td><input id="fieldSpecies" type="text" placeholder="Species"/></td>
					</tr>
					<tr>
						<th>Feeder Load</th>
						<td><input id="fieldLoad" type="number" placeholder="Initial Feeder Weight (grams)"/></td>
					</tr>
					<tr>
						<td colspan="2"><button id="addUnit">Submit</button></td>
					</tr>
				</table>
			</div>
		</div>
	</div>
	<script>
	$(document).ready(function(){
		let uid = null;

		$.fn.logout = function(){
			$.post("/logout", function(result){
				window.location.href = "/";
			});
		};
		
		$.fn.changeFeeder = function(fid){
			$.post("/setFID", {fid:fid}, function(result){
				// alert(result);
				window.location.href = "/FishFeedIndex";
			});
		};

		$.post("/getUserInfo", function(result){
      // console.log("result is",result["user"]);
      if(result["user"] === undefined){
				window.location.href = "/";
      }
			$("#user").html(result["user"]);
			uid = result["uid"];
      $.post("/getFieldUnits", {uid:result["uid"]},function(res){
        let insert = "";
        for(let i = 0; i < res.length; i++){
					insert += "<li class='nav-item'><a href='#' onClick='$(this).changeFeeder("
									+ res[i].fid +")'>"
									+ res[i].label
									+ "</a></li>";
				}
				$("#fieldUnits").html(insert);
			});
		});
		
		$("#addUnit").click(function(){
			console.log("CLICK");
			let label = $("#fieldLabel").val();
			let number = $("#fieldNumber").val();
			let species = $("#fieldSpecies").val();
			let load = $("#fieldLoad").val();
			if(label == "" || number == "" || species == "" || load == ""){
				alert("woi a field is missing");
			}else{
				//do query
				$.post("/addUnit", {uid:uid, label:label, phoneno:number, species:species, feederload:load}, function(response){
					// console.log(response);
					alert("Successfully added the new field unit details!");
					window.location.href = "/FishFeedIndex";
				});
			}
		});
	});</script>
</body>
</html>